#!/usr/bin/env bash

# Check if ONLYOFFICE_MODE is set
if [ -z "$ONLYOFFICE_MODE" ]; then
  echo "[ERROR] The ONLYOFFICE_MODE environment variable is not set."
  echo "Possible values: docservice, fileconverter, proxy"
  exit 1
fi

echo "Current mode: $ONLYOFFICE_MODE"

# ===============================
# Actions based on ONLYOFFICE_MODE
# ===============================

case "$ONLYOFFICE_MODE" in
  docservice)
    cat << EOF
---
addons:
  - scalingo-postgresql
config_vars:
  PATH: /app/server/DocService:/app/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
default_process_types:
  docservice: docservice
  postdeploy: psql "${SCALINGO_POSTGRESQL_URL}" < /app/server/schema/postgresql/createdb.sql
EOF
    ;;
  
  fileconverter)
    cat << EOF
---
addons:
config_vars:
  PATH: /app/server/FileConverter:/app/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
default_process_types:
  fileconverter: converter & bin/run
EOF
    ;;
  
  *)
    echo "[ERROR] Unknown value for ONLYOFFICE_MODE: '$ONLYOFFICE_MODE'"
    echo "Valid values: docservice | fileconverter"
    exit 1
    ;;
esac
